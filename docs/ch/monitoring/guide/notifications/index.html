

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="description" content="Description">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <!-- <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script> -->
    <link rel="stylesheet" href="https://unpkg.com/docsify/lib/themes/vue.css">
    <link rel="stylesheet" href="https://unpkg.com/docsify-copy-code/styles.css">
    <link rel=“prefetch” href="https://fonts.googleapis.com/css?family=Roboto:400,500">
    <link rel="stylesheet" href="/assets/css/normalize.css">
    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="stylesheet" href="/assets/css/bundle.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
    <link rel="stylesheet" href="//unpkg.com/gitalk/dist/gitalk.css">
</head>

<body class="ready sticky">

    <template id="sidebar2-template">
    <div class="sidebar_2_wrapper">
        <div class="sidebar_2">
            <a href="/runtime/overview" data-page="runtime-page">
                <div class="sidebar_2_item sidebar_2_item_runtime">
                    <img class="sidebar_2_item__image" src="/assets/static/pm2-logo-r.png">
                    <div class="sidebar_2_item__text">Runtime</div>
                </div>
            </a>
            <a href="/monitoring/overview" data-page="monitoring-page">
                <div class="sidebar_2_item sidebar_2_item_monitoring">
                    <img class="sidebar_2_item__image" src="/assets/static/pm2-logo-m.png">
                    <div class="sidebar_2_item__text">Monitoring</div>
                </div>
            </a>
            <a href="/enterprise/overview" data-page="enterprise-page">
                <div class="sidebar_2_item sidebar_2_item_enterprise">
                    <img class="sidebar_2_item__image" src="/assets/static/pm2-logo-e.png">
                    <div class="sidebar_2_item__text">Enterprise</div>
                </div>
            </a>
        </div>
        <div class="main_content">
        </div>
    </div>
</template>
<div class="footer-fixed-box"></div>
<div class="section header-section">
    <div class=" header-container">
        <div class="PM2_logo_wrapper">
            <a class="logo-container link">
                <div class="PM2_logo"></div>
            </a>
        </div>
        <div class="PM2_search search-wrapper">
            <span class="algolia-autocomplete" style="position: relative; display: inline-block; direction: ltr;"><input class="search_input ds-input" placeholder="Search documentation..." autocomplete="off" spellcheck="false" role="combobox" aria-autocomplete="list" aria-expanded="false" aria-owns="algolia-autocomplete-listbox-0" dir="auto" style="position: relative; vertical-align: top;"><pre aria-hidden="true" style="position: absolute; visibility: hidden; white-space: pre; font-family: Blender, sans-serif; font-size: 18px; font-style: normal; font-variant: normal; font-weight: 400; word-spacing: 0px; letter-spacing: normal; text-indent: 0px; text-rendering: auto; text-transform: none;"></pre><span class="ds-dropdown-menu" role="listbox" id="algolia-autocomplete-listbox-0" style="position: absolute; top: 100%; z-index: 100; display: none; left: 0px; right: auto;"><div class="ds-dataset-1"></div></span></span>
            <div class="PM2_search_icon"><i class="fas fa-search"></i></div>
            <div id="hits" class="algolia-results">
                <!-- Hits widget will appear here -->
            </div>
        </div>
    </div>
</div>
<nav class="app-nav no-badge">
    <!--navbar-->
</nav>

    <!-- MAIN-CONTENT AREA -->
    <main>
        <aside class="sidebar">
    <div class="sidebar_2_wrapper">
        <div class="sidebar_2">
            <a href="/runtime/overview" data-page="runtime-page">
                <div class="sidebar_2_item sidebar_2_item_runtime">
                    <img class="sidebar_2_item__image" src="/assets/static/pm2-logo-r.png">
                    <div class="sidebar_2_item__text">Runtime</div>
                </div>
            </a>
            <a href="/monitoring/overview" data-page="monitoring-page">
                <div class="sidebar_2_item sidebar_2_item_monitoring">
                    <img class="sidebar_2_item__image" src="/assets/static/pm2-logo-m.png">
                    <div class="sidebar_2_item__text">Monitoring</div>
                </div>
            </a>
            <a href="/enterprise/overview" data-page="enterprise-page">
                <div class="sidebar_2_item sidebar_2_item_enterprise">
                    <img class="sidebar_2_item__image" src="/assets/static/pm2-logo-e.png">
                    <div class="sidebar_2_item__text">Enterprise</div>
                </div>
            </a>
        <div class="lang-selector">
          <!-- Adds links to other languages on the post -->
          
            
              
                <a href="/monitoring/guide/notifications/" >Language: English</a>
              

              

              

            
          
            
          
        </div>
        </div>
        <div class="main_content">
        </div>
    </div>
    <div class="sidebar-nav">

    <ul id="acc">
    
    
    
    
    
        <li class="">
            <a href="/ch/monitoring/overview/">Overview</a>
            
        </li>
    
    
    
    
        <li class="">
            <a href="/ch/monitoring/quick-start/">Quick Start</a>
            
        </li>
    
    
    
    
        <li class="active">
            <a href="/ch/monitoring/guide/">Guide</a>
            
                
                    <ul>
                        
                        
                        <li class=""><a href="/ch/monitoring/guide/installation/">Installation</a></li>
                        
                        
                        <li class=""><a href="/ch/monitoring/guide/configuration/">Configuration</a></li>
                        
                        
                        <li class="active"><a href="/ch/monitoring/guide/notifications/">Notification</a></li>
                        
                        
                        <li class=""><a href="/ch/monitoring/guide/issue-dashboard/">Issue dashboard</a></li>
                        
                        
                        <li class=""><a href="/ch/monitoring/guide/transaction-tracing/">Transaction tracing</a></li>
                        
                        
                        <li class=""><a href="/ch/monitoring/guide/memory-cpu-profiling/">Memory & CPU Profiling</a></li>
                        
                    </ul>
                
            
        </li>
    
    
    
    
        <li class="">
            <a href="/ch/monitoring/integration/">Integration</a>
            
                
            
        </li>
    
    
    
    
        <li class="">
            <a href="/ch/monitoring/reference/">References</a>
            
        </li>
    
    </ul>

    </div>
</aside>

        <section class="content">
            <div class="markdown-section gettings_started_block topBlock">
    <p style="display: initial;">Getting started with PM2<span class="runtime_block gettings_started_block_span">Runtime</span><span class="monitoring_block gettings_started_block_span">Monitoring</span><span class="enterprise_block gettings_started_block_span">Enterprise</span></p>
</div>
            <article id="main" class="markdown-section">
                 <h1 id="notifications">Notifications</h1>

<p>Notifications always gets you aware about critical events.</p>

<p>By default, you receive emails only on critical events:</p>
<ul>
  <li>downtime</li>
  <li>deployment</li>
  <li>issues</li>
</ul>

<p>This section will help you to setup custom notifications and to configure the channels where you want to receive them.</p>

<hr />

<h2 id="default-notifications">Default notifications</h2>

<p>By default, pm2 sends few different kind of notifications:</p>

<ul>
  <li>When a new exception is thrown.</li>
</ul>

<p>[New Exception] Exception detected on <em>process_name</em></p>

<ul>
  <li>
    <p>When a server is offline for more than 90 seconds</p>
  </li>
  <li>
    <p>After a deployment</p>
  </li>
</ul>

<p>[App Malfunctioning] Application throws too many errors (<em>process_name</em>)</p>

<hr />

<h2 id="custom-notifications">Custom notifications</h2>

<h3 id="custom-metric-notifications">Custom metric notifications</h3>

<p>The main way to set custom notification with pm2 monitoring is to use the custom metrics.</p>

<p>When defining a custom metric, you can enable notifications on them when they reach a specific threshold.</p>

<p>Example :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">metric</span> <span class="o">=</span> <span class="nx">probe</span><span class="p">.</span><span class="nx">metric</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'CPU usage'</span><span class="p">,</span>
  <span class="na">value</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">cpu_usage</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="na">alert</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">mode</span><span class="p">:</span> <span class="s1">'threshold'</span><span class="p">,</span>
    <span class="na">value</span><span class="p">:</span> <span class="mi">95</span><span class="p">,</span>
    <span class="na">msg</span><span class="p">:</span> <span class="s1">'Detected over 95% CPU usage'</span><span class="p">,</span> <span class="c1">// optional</span>
    <span class="na">action</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="c1">//optional</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'Detected over 95% CPU usage'</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">cmp</span><span class="p">:</span> <span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">threshold</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="c1">//optional</span>
      <span class="k">return</span> <span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">threshold</span><span class="p">);</span> <span class="c1">// default check</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Available options are:</p>

<ul>
  <li><code class="highlighter-rouge">mode</code>:
    <ul>
      <li><code class="highlighter-rouge">threshold</code>: trigger an alert directly when the value is above or below the threshold</li>
      <li><code class="highlighter-rouge">threshold-avg</code>: trigger an alert when the value is above or below the threshold for <em>X</em> seconds</li>
      <li><code class="highlighter-rouge">smart</code>: trigger an alert automatically when the value is unusual</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">value</code>: Value that will be used for the exception check.</li>
  <li><code class="highlighter-rouge">msg</code>: String used for the exception.</li>
  <li><code class="highlighter-rouge">action</code>:  <strong>optional</strong>. Function triggered when the exception is reached.</li>
  <li><code class="highlighter-rouge">cmp</code>: <strong>optional</strong>. Function used for exception check taking 2 arguments.</li>
  <li><code class="highlighter-rouge">interval</code>: <strong>optional</strong>, <code class="highlighter-rouge">threshold-avg</code> mode. Sample length for monitored value (180 seconds default).</li>
  <li><code class="highlighter-rouge">timeout</code>: <strong>optional</strong>, <code class="highlighter-rouge">threshold-avg</code> mode. Time after which mean comparison starts (30 000 milliseconds default).</li>
</ul>

<h3 id="custom-event-notifications">Custom event notifications</h3>

<p>An other way to set a custom notifications is to use a custom event.</p>

<p>After having defined a custom event, subscribe to it directly in the dashboard.</p>

<hr />

<h2 id="notification-channels">Notification channels</h2>

<p>By default, notifications are sent by email. You can also receive them on slack or via a webhook.</p>

<h3 id="slack-notifications">Slack notifications</h3>

<p>The Slack integration allows you to receive exceptions and event notifications straight into a selected Slack channel.</p>

<p>First you need to get the Slack URL and to setup an incoming Webhook. More details on how to set this up can be found here: <a href="https://my.slack.com/services/new/incoming-webhook/">https://my.slack.com/services/new/incoming-webhook/</a> or <a href="https://api.slack.com/incoming-webhooks">https://api.slack.com/incoming-webhooks</a>.</p>

<p>Then go to the notification page and insert the webhook into the field. Enable and click on update.</p>

<p>Check if you successfully received a notification into your slack channel confirming that it has been configured.</p>

<h3 id="webhooks">Webhooks</h3>

<p>You can also set a webhook that will make POST HTTP request to a given URL when you receive a notifications.</p>

<p>The format of the data is a json like the following:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w"> </span><span class="p">{</span><span class="w">
   </span><span class="s2">"event"</span><span class="p">:</span><span class="s2">"event:new_exception"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"data"</span><span class="p">:{</span><span class="w">
      </span><span class="s2">"process"</span><span class="p">:{</span><span class="w">
         </span><span class="s2">"pm_id"</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span><span class="w">
         </span><span class="s2">"name"</span><span class="p">:</span><span class="s2">"pm2-elasticsearch"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"rev"</span><span class="p">:</span><span class="s2">"ac77098c5e1b10d74360b113da6e717fab8fe427"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"server"</span><span class="p">:</span><span class="s2">"pm2-module-testing"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="s2">"data"</span><span class="p">:{</span><span class="w">
         </span><span class="s2">"message"</span><span class="p">:</span><span class="s2">"Bad argument"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"stack"</span><span class="p">:</span><span class="s2">"TypeError: Bad argument</span><span class="se">\n</span><span class="s2">    at TypeError (native)</span><span class="se">\n</span><span class="s2">    at ChildProcess.spawn (internal/child_process.js:274:26)</span><span class="se">\n</span><span class="s2">    at exports.spawn (child_process.js:362:9)</span><span class="se">\n</span><span class="s2">    at Object.exports.execFile (child_process.js:151:15)</span><span class="se">\n</span><span class="s2">    at exports.exec (child_process.js:111:18)</span><span class="se">\n</span><span class="s2">    at /home/node/pm2-elasticsearch/lib/actions.js:25:5</span><span class="se">\n</span><span class="s2">    at process.&lt;anonymous&gt; (/home/node/pm2-elasticsearch/node_modules/pmx/lib/actions.js:64:14)</span><span class="se">\n</span><span class="s2">    at emitTwo (events.js:92:20)</span><span class="se">\n</span><span class="s2">    at process.emit (events.js:172:7)</span><span class="se">\n</span><span class="s2">    at handleMessage (internal/child_process.js:695:10)"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="s2">"at"</span><span class="p">:</span><span class="mi">1472651928925</span><span class="p">,</span><span class="w">
      </span><span class="s2">"created_at"</span><span class="p">:</span><span class="mi">1472651928925</span><span class="p">,</span><span class="w">
      </span><span class="s2">"updated_at"</span><span class="p">:</span><span class="mi">1472651928925</span><span class="p">,</span><span class="w">
      </span><span class="s2">"count"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="s2">"identifier"</span><span class="p">:</span><span class="s2">"ad6f8650dabfec83f183633b0bba7d97"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"infected_servers"</span><span class="p">:[</span><span class="w">
         </span><span class="s2">"pm2-module-testing"</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="s2">"timestamps"</span><span class="p">:[</span><span class="w">
         </span><span class="mi">1472651928925</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="s2">"commits"</span><span class="p">:[</span><span class="w">
         </span><span class="s2">"ac77098c5e1b10d74360b113da6e717fab8fe427"</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="s2">"bucket_url"</span><span class="p">:</span><span class="s2">"https://app.keymetrics.io/#/bucket/YOUR_BUCKET_ID/exceptions"</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Use case example: You can now setup an express server that can receive webhooks, automatically send SMS or use any integration you want.</p>

<hr />

<h2 id="next-steps">Next steps</h2>

<p><a href="monitoring/guide/issue-dashboard.md">Issue Dashboard</a></p>

<hr />

<h2 id="questions-">Questions ?</h2>

<p>We are always happy to help with questions you might have. Search our documentation or check out answers to common questions. You can also post questions or comments to our community forum. You can also have a look at our support github https://github.com/keymetrics/keymetrics-support</p>


            </article>

        <article class="markdown-section copyright">
    <p>© 2018 Keymetrics</p>
    <ul id="footer">
        <li><a href="javascript:void(0);">Terms of Use</a></li>
        <li><a href="javascript:void(0);">Privacy Policy</a></li>

        <!-- Adds links to other languages on the post -->
        
          
            
              <li><p class="footer-list">Language: <a href="/monitoring/guide/notifications/" >English</a></p></li>
            

            

            

          
        
          
        
    </ul>
</article>

        </section>

    </main>
</body>
    <script>window.$docsify = {"basePath":"/docs","alias":{"/runtime/.*/_sidebar.md":"/runtime/_sidebar.md","/monitoring/.*/_sidebar.md":"/monitoring/_sidebar.md","/enterprise/.*/_sidebar.md":"/enterprise/_sidebar.md"},"auto2top":true,"coverpage":false,"executeScript":true,"loadSidebar":"_sidebar.md","loadNavbar":false,"mergeNavbar":false,"subMaxLevel":1,"name":"","search":false,"plugins":[],"routerMode":"history"}</script>
<!-- <script src="//unpkg.com/docsify/lib/docsify.min.js"></script> -->
<!-- <script src="/ch/assets/js/docsify.js"></script> -->
<script src="/assets/js/scripts.js" type="text/javascript"></script>
<script src="https://unpkg.com/clipboard@2.0.0/dist/clipboard.min.js" type="text/javascript"></script>
<script src="https://unpkg.com/prismjs@1.13.0/prism.js" type="text/javascript"></script>
<script src="https://unpkg.com/prismjs/components/prism-bash.min.js" type="text/javascript"></script>
<script src="https://unpkg.com/prismjs/components/prism-markdown.min.js" type="text/javascript"></script>
<script src="https://unpkg.com/prismjs/components/prism-nginx.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.10.0/js/md5.min.js" type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="/assets/js/prism-clipboard.js" type="text/javascript"></script>
<!-- <script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script> -->
<!-- <script src="/ch/assets/js/gittalk.js"></script> -->
<script src="/assets/js/keymetrics-plugins.js" type="text/javascript"></script>
<script src="/assets/js/additional.js" type="text/javascript"></script>
</html>
